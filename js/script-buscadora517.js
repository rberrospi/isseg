$(document).ready(function(){$('.seleccion').click(function(){icono=$(this).find('.icono-seleccion');color=icono.attr('data-color');filtro=icono.attr('data-filtro');valor=icono.attr('data-valor');if(icono.css('background-color')=='rgb(255, 255, 255)'||icono.css('background-color')=='rgb(221, 221, 221)'){icono.css('background-color',color);if($(this).hasClass('metod-curso')){$('.agrupacion-cursos').find('.icono-seleccion').each(function(){if($(this).css('background-color')=='rgb(255, 255, 255)'){color=$(this).attr('data-color');filtro=$(this).attr('data-filtro');valor=$(this).attr('data-valor');$(this).css('background-color',color);$("input[name='"+ filtro+"']").val($("input[name='"+ filtro+"']").val()+($("input[name='"+ filtro+"']").val()!=""?",":"")+ valor);}});$('.agrupacion-cursos').show();}else{$("input[name='"+ filtro+"']").val($("input[name='"+ filtro+"']").val()+($("input[name='"+ filtro+"']").val()!=""?",":"")+ valor);if(icono.hasClass('curso')){color=$(".metod-curso").find('.icono-seleccion').attr('data-color');$('.agrupacion-cursos').find('.icono-seleccion').each(function(){if($(this).css('background-color')=='rgb(255, 255, 255)'){color="#dddddd";}});$(".metod-curso").find('.icono-seleccion').css('background-color',color);}}}else{icono.css('background-color','#ffffff');if($(this).hasClass('metod-curso')){$('.agrupacion-cursos').find('.icono-seleccion').each(function(){if($(this).css('background-color')!='rgb(255, 255, 255)'){$(this).css('background-color','#ffffff');filtro=$(this).attr('data-filtro');valor=$(this).attr('data-valor');aux_valor=","+ $("input[name='"+ filtro+"']").val()+",";aux_valor=aux_valor.replace(","+ valor+",",",");aux_valor=aux_valor.length>2?aux_valor.substring(1,aux_valor.length- 1):"";$("input[name='"+ filtro+"']").val(aux_valor);}});$('.agrupacion-cursos').hide();}else{aux_valor=","+ $("input[name='"+ filtro+"']").val()+",";aux_valor=aux_valor.replace(","+ valor+",",",");aux_valor=aux_valor.length>2?aux_valor.substring(1,aux_valor.length- 1):"";$("input[name='"+ filtro+"']").val(aux_valor);if(icono.hasClass('curso')){color="#ffffff";$('.agrupacion-cursos').find('.icono-seleccion').each(function(){if($(this).css('background-color')!='rgb(255, 255, 255)'){color="#dddddd";}});$(".metod-curso").find('.icono-seleccion').css('background-color',color);}}}
busqueda_avanzada($("input[name='tipo_formacion']").val(),$("input[name='area']").val(),$("input[name='modalidad']").val(),$("input[name='sede']").val(),$("input[name='buscar_avanzado']").val().length>=3?$("input[name='buscar_avanzado']").val():"");});$('.seleccion').mouseover(function(){texto=$(this).find('.titulo-seleccion');texto.css('text-decoration','underline');});$('.seleccion').mouseout(function(){texto=$(this).find('.titulo-seleccion');texto.css('text-decoration','none');});$('.borrar-seleccion').click(function(){$("input[name='buscar_avanzado']").val("");cambio_palabra_clave($("input[name='buscar_avanzado']"));});$(".ver_filtros").click(function(){if($(this).html()=="Mostrar filtros"){$(this).html("Ocultar filtros");$(".filtro").slideDown();}else{$(this).html("Mostrar filtros");$(".filtro").slideUp();}});$(".boton-filtrar").click(function(){$(".ver_filtros").html("Mostrar filtros");$(".filtro").hide();});function busqueda_avanzada(id_tipo_formacion,id_area,id_modalidad,id_sede,patron_busqueda,id_pagina,loader){if(loader===undefined){$("#shadow_loader").show();}
if(id_pagina===undefined){id_pagina=1;}
$.ajax({url:"../ajax/ajax_buscador.php",method:"POST",data:{buscar:patron_busqueda,tipo_formacion:id_tipo_formacion,area:id_area,modalidad:id_modalidad,sede:id_sede,pagina:id_pagina},dataType:"json",success:function(result){if(result[0].total==0){id_pagina=1;$.ajax({url:"../ajax/ajax_destacados.php",method:"POST",dataType:"json",success:function(result2){if(result2[0].total==0){$("#shadow_loader").fadeOut(200,function(){num_pags=1;paginador='<div class="pag-buscador txpag">Pág. </div>';if(num_pags>1){for(pag=1;pag<=num_pags;pag++){pag_marcada=pag==id_pagina?'pag-marcada':'';paginador+='<div class="pag-buscador '+ pag_marcada+'" title="Página '+ pag+'" data-pag="'+ pag+'">'+ pag+'</div>';}}
$(".paginador").html(paginador);$("#mensaje-destacados").remove();$("#resultados-busqueda-avanzada").html('<div class="subapart"><div class="resulta">Sin resultados</div></div>');});}else{num_pags=result2[0].num_pags;paginador='<div class="pag-buscador txpag">Pág. </div>';for(pag=1;pag<=num_pags;pag++){pag_marcada=pag==id_pagina?'pag-marcada':'';paginador+='<div class="pag-buscador '+ pag_marcada+'" title="Página '+ pag+'" data-pag="'+ pag+'">'+ pag+'</div>';}
resultado_busqueda="";id_categoria="0";for(i=1;i<result2.length;i++)
{if(result2[i].id_categoria!=id_categoria){if(resultado_busqueda!=""){resultado_busqueda+='</div>';}
resultado_busqueda+='<div class="subapart">';resultado_busqueda+='<div class="resulta titulo-titulacion">';resultado_busqueda+='<div class="filtro-programa">';resultado_busqueda+='<h3>'+ result2[i].categoria.toUpperCase()+'</h3>';resultado_busqueda+='</div>';resultado_busqueda+='<div class="filtro-area">';resultado_busqueda+='</div>';resultado_busqueda+='<div class="filtro-metodologia">';resultado_busqueda+='</div>';resultado_busqueda+='</div>';id_categoria=result2[i].id_categoria;}
resultado_busqueda+='<div class="resulta">';resultado_busqueda+='<div class="filtro-programa"><div itemscope itemtype="http://schema.org/EducationEvent"><meta itemprop="startDate" content="'+(new Date).getFullYear()+'-'+((new Date).getMonth()+((new Date).getDate()<10?1:2))+'-16">';resultado_busqueda+='<a href="'+ result2[i].url_categoria+'/'+ result2[i].aliasurl+'" title="'+ result2[i].nombrecurso+'" onClick="dataLayer.push({\'category\': \'Buscador-Avanzado\', \'action\': \'clic\', \'label\': \''+ result2[i].url_categoria+'/'+ result2[i].aliasurl+'\', \'event\': \'evento\'});"><span itemprop="name">'+ result2[i].nombrecursoweb+'</span></a>';resultado_busqueda+='</div></div>';resultado_busqueda+='<div class="filtro-area">';resultado_busqueda+='<div class="icono-seleccion" title="'+ result2[i].tematica+'" style="background-color: '+ result2[i].color_tematica+'"></div>';resultado_busqueda+='</div>';resultado_busqueda+='<div class="filtro-metodologia">';for(j=0;j<result2[i].modalidades.length;j++)
{resultado_busqueda+='<div class="icono" style="background: url(/img/iconos/'+ result2[i].modalidades[j].imagen+');" title="'+ result2[i].modalidades[j].modalidad+'">';resultado_busqueda+='</div>';}
resultado_busqueda+='</div>';resultado_busqueda+='</div>';}
resultado_busqueda+='</div>';$("#shadow_loader").fadeOut(200,function(){$(".paginador").html(paginador);$(".pag-buscador:not(.pag-marcada)").click(function(){busqueda_avanzada($("input[name='tipo_formacion']").val(),$("input[name='area']").val(),$("input[name='modalidad']").val(),$("input[name='sede']").val(),$("input[name='buscar_avanzado']").val().length>=3?$("input[name='buscar_avanzado']").val():"",$(this).attr('data-pag'));if($(this).parent().parent().hasClass("pie-buscador")){$(window).scrollTop($("div.apartado-buscador").position().top);}});if(!$("#mensaje-destacados").is(":visible")){$(".listado-filtro-masters").prepend("<div class='subapart' id='mensaje-destacados'><div>No se han encontrado resultados para tu búsqueda.</div><div>Te mostramos a continuación como sugerencia los Masters que consideramos más interesantes. También puedes volver a utilizar nuestro buscador o navegar por las secciones del menú superior.</div></div>");}
$("#resultados-busqueda-avanzada").html(resultado_busqueda);});}},error:function(xhr){$("#shadow_loader").fadeOut(200,function(){num_pags=1;paginador='<div class="pag-buscador txpag">Pág. </div>';for(pag=1;pag<=num_pags;pag++){pag_marcada=pag==id_pagina?'pag-marcada':'';paginador+='<div class="pag-buscador '+ pag_marcada+'" title="Página '+ pag+'" data-pag="'+ pag+'">'+ pag+'</div>';}
$(".paginador").html(paginador);$("#mensaje-destacados").remove();$("#resultados-busqueda-avanzada").html('Ha ocurrido un error al cargar los datos: '+ xhr.status+', '+ xhr.statusText);});}});}else{num_pags=result[0].num_pags;paginador='<div class="pag-buscador txpag">Pág. </div>';for(pag=1;pag<=num_pags;pag++){pag_marcada=pag==id_pagina?'pag-marcada':'';paginador+='<div class="pag-buscador '+ pag_marcada+'" title="Página '+ pag+'" data-pag="'+ pag+'">'+ pag+'</div>';}
resultado_busqueda="";id_categoria="0";destacado="";for(i=1;i<result.length;i++)
{if((result[i].id_categoria!=id_categoria&&destacado!="1")||result[i].destacado!=destacado){if(resultado_busqueda!=""){resultado_busqueda+='</div>';}
if(result[i].destacado=='1'){resultado_busqueda+='<div class="subapart"></div>';resultado_busqueda+='<div class="subapart destacados">';}else if(result[i].destacado=='0'){if(destacado=='1'){resultado_busqueda+='<div class="subapart"></div>';}
resultado_busqueda+='<div class="subapart">';}
resultado_busqueda+='<div class="resulta titulo-titulacion">';resultado_busqueda+='<div class="filtro-programa">';if(result[i].destacado=='1'){resultado_busqueda+='<h3>DESTACADOS</h3>';}else if(result[i].destacado=='0'){resultado_busqueda+='<h3>'+ result[i].categoria.toUpperCase()+'</h3>';}
resultado_busqueda+='</div>';resultado_busqueda+='<div class="filtro-area">';resultado_busqueda+='</div>';resultado_busqueda+='<div class="filtro-metodologia">';resultado_busqueda+='</div>';resultado_busqueda+='</div>';id_categoria=result[i].id_categoria;destacado=result[i].destacado;}
resultado_busqueda+='<div class="resulta">';resultado_busqueda+='<div class="filtro-programa"><div itemscope itemtype="http://schema.org/EducationEvent"><meta itemprop="startDate" content="'+(new Date).getFullYear()+'-'+((new Date).getMonth()+((new Date).getDate()<10?1:2))+'-16">';resultado_busqueda+='<a href="'+ result[i].url_categoria+'/'+ result[i].aliasurl+'" title="'+ result[i].nombrecurso+'" onClick="dataLayer.push({\'category\': \'Buscador-Avanzado\', \'action\': \'clic\', \'label\': \''+ result[i].url_categoria+'/'+ result[i].aliasurl+'\', \'event\': \'evento\'});"><span itemprop="name">'+ result[i].nombrecursoweb+'</span></a>';resultado_busqueda+='</div></div>';resultado_busqueda+='<div class="filtro-area">';resultado_busqueda+='<div class="icono-seleccion" title="'+ result[i].tematica+'" style="background-color: '+ result[i].color_tematica+'"></div>';resultado_busqueda+='</div>';resultado_busqueda+='<div class="filtro-metodologia">';for(j=0;j<result[i].modalidades.length;j++)
{resultado_busqueda+='<div class="icono" style="background: url(/img/iconos/'+ result[i].modalidades[j].imagen+');" title="'+ result[i].modalidades[j].modalidad+'">';resultado_busqueda+='</div>';}
resultado_busqueda+='</div>';resultado_busqueda+='</div>';}
resultado_busqueda+='</div>';if(destacado=='1'){resultado_busqueda+='<div class="subapart"></div>';}
$("#shadow_loader").fadeOut(200,function(){$(".paginador").html(paginador);$(".pag-buscador:not(.pag-marcada)").click(function(){busqueda_avanzada($("input[name='tipo_formacion']").val(),$("input[name='area']").val(),$("input[name='modalidad']").val(),$("input[name='sede']").val(),$("input[name='buscar_avanzado']").val().length>=3?$("input[name='buscar_avanzado']").val():"",$(this).attr('data-pag'));if($(this).parent().parent().hasClass("pie-buscador")){$(window).scrollTop($("div.apartado-buscador").position().top);}});$("#mensaje-destacados").remove();$("#resultados-busqueda-avanzada").html(resultado_busqueda);$.ajax({url:"../ajax/ajax_buscador_productos.php",method:"POST",data:{buscar:patron_busqueda,tipo_formacion:id_tipo_formacion,area:id_area,modalidad:id_modalidad,sede:id_sede},dataType:"json",success:function(result3){id_categoria="0";combo_cursos='<option value="0">Selecciona tu curso *</option>';arr_prod_TradeDoubler='';for(i=1;i<result3.length;i++)
{if(result3[i].id_categoria!=id_categoria){if(id_categoria!="0"){combo_cursos+='</optgroup>';}
combo_cursos+='<optgroup label="'+ result3[i].categoria+'">';id_categoria=result3[i].id_categoria;}
combo_cursos+='<option value="'+ result3[i].id_curso_imf+'">'+ result3[i].nombrecurso+'</option>';if(arr_prod_TradeDoubler!=''){arr_prod_TradeDoubler+=',';}
arr_prod_TradeDoubler+='{id: "'+ result3[i].id_curso_imf+'", price:"'+ result3[i].preciocursosinbeca+'", currency:"EUR", name:"'+ result3[i].nombrecurso+'"}';}
combo_cursos+='</optgroup>';$("#id_curso_imf").html(combo_cursos);if($("#TagTradeDoubler").html()==""){tagTradeDoubler='';tagTradeDoubler+='<script type="text/javascript">';tagTradeDoubler+='	var TDConf = TDConf || {}; ';tagTradeDoubler+='	TDConf.Config = { ';tagTradeDoubler+='	  products:[ '+ arr_prod_TradeDoubler+' ], ';tagTradeDoubler+='	  Category_name : "'+ paginaTradeDoubler+'", ';tagTradeDoubler+='		containerTagId : "17767" ';tagTradeDoubler+='	}; ';tagTradeDoubler+='	if(typeof (TDConf) != "undefined"){ ';tagTradeDoubler+='		TDConf.sudomain = ("https:" == document.location.protocol) ? "swrap" : "wrap"; ';tagTradeDoubler+='		TDConf.host = ".tradedoubler.com/wrap"; ';tagTradeDoubler+='		TDConf.containerTagURL = (("https:" == document.location.protocol) ? "https://" : "http://")  + TDConf.sudomain + TDConf.host; ';tagTradeDoubler+='		if (typeof (TDConf.Config) != "undefined") { ';tagTradeDoubler+='			   var TDAsync = document.createElement(\'script\'); ';tagTradeDoubler+='					TDAsync.src = TDConf.containerTagURL  + "?id="+ TDConf.Config.containerTagId; ';tagTradeDoubler+='					TDAsync.async = true; ';tagTradeDoubler+='				document.body.appendChild(TDAsync); ';tagTradeDoubler+='			} ';tagTradeDoubler+='	} ';tagTradeDoubler+='</script>';$("#TagTradeDoubler").html(tagTradeDoubler);}},error:function(xhr){$("#id_curso_imf").html('<option value="0">Ha ocurrido un error al cargar los datos: '+ xhr.status+', '+ xhr.statusText+'</option>');}});});}},error:function(xhr){$("#shadow_loader").fadeOut(200,function(){num_pags=1;paginador='<div class="pag-buscador txpag">Pág. </div>';for(pag=1;pag<=num_pags;pag++){pag_marcada=pag==id_pagina?'pag-marcada':'';paginador+='<div class="pag-buscador '+ pag_marcada+'" title="Página '+ pag+'" data-pag="'+ pag+'">'+ pag+'</div>';}
$(".paginador").html(paginador);$("#mensaje-destacados").remove();$("#resultados-busqueda-avanzada").html('Ha ocurrido un error al cargar los datos: '+ xhr.status+', '+ xhr.statusText);});}});}
function cambio_palabra_clave(input_busqueda){if($(input_busqueda).val().length>=3){$("#filtro_palabra").html('RESULTADOS DE "'+ $(input_busqueda).val().toUpperCase()+'"');}else{$("#filtro_palabra").html("");}
busqueda_avanzada($("input[name='tipo_formacion']").val(),$("input[name='area']").val(),$("input[name='modalidad']").val(),$("input[name='sede']").val(),$(input_busqueda).val().length>=3?$(input_busqueda).val():"",1,false);}
$("input[name='buscar_avanzado']").keyup(function(){cambio_palabra_clave(this);});busqueda_avanzada($("input[name='tipo_formacion']").val(),$("input[name='area']").val(),$("input[name='modalidad']").val(),$("input[name='sede']").val(),$("input[name='buscar_avanzado']").val().length>=3?$("input[name='buscar_avanzado']").val():"");});